{% include 'header.html' %}
{% include 'banner.html' %}

<div class="calendar">
    <div class="month">
        <i class="bi bi-caret-left-fill"></i>
        <div class="date">
            <h1>December</h1>
            <p>Wednesday December 8, 2021</p>
        </div>
        <i class="bi bi-caret-right-fill"></i>
    </div>
    <div class="weekdays">
        <div>Sunday</div>
        <div>Monday</div>
        <div>Tuesday</div>
        <div>Wednesday</div>
        <div>Thursday</div>
        <div>Friday</div>
        <div>Saturday</div>
    </div>
    <div class="days">
        <div class="prev-days">26</div>
        <div class="prev-days">27</div>
        <div class="prev-days">28</div>
        <div class="prev-days">29</div>
        <div class="prev-days">30</div>
        <div>1</div>
        <div>2</div>
        <div>3</div>
        <div>4</div>
        <div>
            <p>5</p>
            <div id="2021-12-05">
                
            </div>
        </div>
        <div>6</div>
        <div>7</div>
        <div class="today">8</div>
        <div>9</div>
        <div>10</div>
        <div>11</div>
        <div>12</div>
        <div>13</div>
        <div>14</div>
        <div>15</div>
        <div>16</div>
        <div>17</div>
        <div>18</div>
        <div>19</div>
        <div>20</div>
        <div>21</div>
        <div>22</div>
        <div>23</div>
        <div>24</div>
        <div>25</div>
        <div>26</div>
        <div>27</div>
        <div>28</div>
        <div>29</div>
        <div>30</div>
        <div>31</div>
        <div class="next-days">1</div>
        <div class="next-days">2</div>
        <div class="next-days">3</div>
        <div class="next-days">4</div>
        <div class="next-days">5</div>
        <div class="next-days">6</div>
    </div>
</div>

<!--This div is for the left aligned elements below the calendar-->
<div class="">
    <!-- Button trigger modal -->
    <!-- <button type="button" class="btn btn-outline-success" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
        Add Task <i class="bi bi-plus-circle"></i>
    </button> -->
    
    <!-- Modal -->
    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="staticBackdropLabel">Add New Task</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- let user input date and data for the task -->
                        <!-- the form body to insert the task with date and content -->
                        <!-- output for date is MM-DD-YYYY -->
                    <form id="add-task-form">
                        <div class="mb-3">
                            <label class="control-label" for="date">Date</label>
                            <input class="form-control datepicker" id="date" name="date" type="date" value="" data-date-format="mm/dd/yyyy" required />
                        </div>
                        <div class="mb-3">
                            <label for="exampleFormControlTextarea1" class="form-label">Task</label>
                            <textarea class="form-control" id="exampleFormControlTextarea1" rows="2" name="description" required></textarea>
                        </div>
                </div>
                <div class="modal-footer">
                        <!-- don't click submit for now -->
                        <button type="submit" class="btn btn-outline-primary" id="add-task">Add Task</button>
                    </form>
                    <button type="button" id="close-add-task" class="btn btn-outline-danger" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

</div>
    <ul class="view">
        <li><button type="button" class="btn btn-outline-success" data-bs-toggle="modal" data-bs-target="#staticBackdrop"><a><i class="bi bi-plus-circle"></i>Add Task</a></button></li>
        <li><button type="button" class="btn btn-outline-success"><a href="/weekly"><i class="bi bi-calendar-range"></i>Weekly View</a></button></li>
        <li><button type="button" class="btn btn-outline-success"><a href="/tasks"><i class="bi bi-calendar2-check"></i>Task View</a></button></li>
    </ul>
</div> <!-- End Calendar-->

<!-- script to add tasks to the database -->
<script>
    // since we don't have centralized javascript code, I had to copy paste this code below from tasks.html with minor tweaks
    function api_create_task(task, success_function) {
        console.log("creating task with:", task)
        $.ajax({
            url: "api/tasks", type: "POST",
            data: JSON.stringify(task),
            contentType: "application/json; charset=utf-8",
            success: success_function
        });
    }

    // More functions for displaying tasks --Sean
    function api_get_tasks(success_function) {
    $.ajax({url:"api/tasks", type:"GET", 
          success:success_function});
    }

    function display_task(x) {
        completed = "";
        // Formatting here will need to be adjusted
        // cal-task in calendar-style.css should be changed as well
        t = '<div style="width:inherit;" id="' + x.id + '" class="cal-task ' +completed+ '">' +
               x.description +
            '</div>';
        $("#"+x.date).append(t)
    }

    function get_current_tasks() {
        api_get_tasks(function(result){
            for (const task of result.tasks) {
            display_task(task);
            }
        });
    }

    // use this function call
    // when "Add Task" button is clicked, then call the api_create_task function with the appropriate data
    $("#add-task").on('click', function(){
        // validate input client-side and then only send the data to create a task
        var date_field = $('#date');
        var text_field = $('#exampleFormControlTextarea1');
        if(date_field.val() == null || date_field.val() == "" || text_field.val() == null || text_field.val() == ""){
            $('#add-task-form').reset();
        }
        else{
            api_create_task({ description: $("#exampleFormControlTextarea1").val(), date: $("#date").val() },
                function (result) {
                    console.log(result);
                    $("#current_input").val("")
                });
            $("#close-add-task").click();
        }

    });

    get_current_tasks();
</script>

{% include 'footer.html' %}